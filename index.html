<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <meta charset="UTF-8" />
  <title>D&D Character Sheet</title>


  <link rel="stylesheet" href="style.css" />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"
  />
  <link rel="stylesheet" href="./ui/skillChoice.css" />
</head>

<body>

<button id="exportPdfBtn" class="primary">
  Export Character Sheet (PDF)
</button>

<h1>D&D Character Sheet</h1>

<div id="app-root">

  <!-- ================= CHARACTER SHEET VIEW ================= -->
  <section id="sheetView">

    <!-- ================= Character Info ================= -->
    <section class="panel">
      <h2>Character</h2>

      <label>
        Character Name
        <input type="text" id="name" />
      </label>

      <label>
        Race
        <select id="raceSelect">
          <option value="">‚Äî Select Race ‚Äî</option>
        </select>

        <!-- ‚ûï Race Detail -->
        <button
          class="detail-btn"
          data-type="race"
          data-id=""
          title="View Race Details"
        >+</button>
      </label>

      <div id="raceDetails"></div>
      <label>
      <section class="panel">
        <h2>Background</h2>

        <label>
          Background
          <select id="backgroundSelect">
            <option value="">‚Äî Select Background ‚Äî</option>
          </select>

          <button
            class="detail-btn"
            data-type="background"
            data-id=""
            title="View Background Details"
          >+</button>
        </label>

        <div id="backgroundDetails"></div>
<section class="panel">
  <h2>Languages</h2>

  <select id="languageSelect" multiple size="10">
    <optgroup label="Standard Languages">
      <option value="common">Common</option>
      <option value="dwarvish">Dwarvish</option>
      <option value="elvish">Elvish</option>
      <option value="giant">Giant</option>
      <option value="gnomish">Gnomish</option>
      <option value="goblin">Goblin</option>
      <option value="halfling">Halfling</option>
      <option value="orc">Orc</option>
    </optgroup>

    <optgroup label="Exotic Languages">
      <option value="abyssal">Abyssal</option>
      <option value="celestial">Celestial</option>
      <option value="deep-speech">Deep Speech</option>
      <option value="draconic">Draconic</option>
      <option value="infernal">Infernal</option>
      <option value="primordial">Primordial</option>
      <option value="sylvan">Sylvan</option>
      <option value="undercommon">Undercommon</option>
    </optgroup>

    <optgroup label="Special">
      <option value="druidic">Druidic</option>
      <option value="thieves-cant">Thieves‚Äô Cant</option>
    </optgroup>
  </select>
</section>
    <!-- ================= Class & Level ================= -->
    <section class="panel">
      <h2>Class & Level</h2>

      <label>
        Level
        <input type="number" id="level" min="1" max="20" value="1" />
      </label>

      <label>
        Class
      <select id="classSelect">
        <option value="">‚Äî Select Class ‚Äî</option>

        <!-- Core PHB Classes -->
        <option value="barbarian">Barbarian</option>
        <option value="bard">Bard</option>
        <option value="cleric">Cleric</option>
        <option value="druid">Druid</option>
        <option value="fighter">Fighter</option>
        <option value="monk">Monk</option>
        <option value="paladin">Paladin</option>
        <option value="ranger">Ranger</option>
        <option value="rogue">Rogue</option>
        <option value="sorcerer">Sorcerer</option>
        <option value="warlock">Warlock</option>
        <option value="wizard">Wizard</option>

        <!-- Official Non-PHB -->
        <option value="artificer">Artificer</option>

        <!-- Homebrew -->
        <option value="ostrumite-gunner">DO NOT CLICK</option>
        <option value="bound-vanguard">DO NOT CLICK</option>
      </select>

        <!-- ‚ûï Class Detail -->
        <button
          class="detail-btn"
          data-type="class"
          data-id=""
          title="View Class Details"
        >+</button>
      </label>

      <p>
        Subclass:
        <strong id="subclassName">‚Äî</strong>
        <button
          class="detail-btn"
          data-type="subclass"
          data-id=""
          title="View Subclass Details"
        >+</button>
      </p>
      <div id="soulTrinketPanel" class="panel" hidden>
        <strong>Soul Trinkets:</strong>
        <button id="soulMinus">‚àí</button>
        <span id="soulTrinketCount">0 / 0</span>
        <button id="soulPlus">+</button>
      </div>

      <p>Proficiency Bonus: <strong id="profBonus">+2</strong></p>
    </section>
    <section class="panel">
  <h2>Rest</h2>

  <button id="shortRestBtn">Short Rest</button>
  <button id="longRestBtn">Long Rest</button>

  <div id="restLog" class="muted"></div>
</section>


    <!-- ================= Skills ================= -->
    <section class="panel">
      <h2>Skills</h2>

    <div class="skills">
      <label><input type="checkbox" id="skill-acrobatics" data-skill-id="acrobatics" /> Acrobatics (DEX)</label>
      <label><input type="checkbox" id="skill-animal-handling" data-skill-id="animal-handling" /> Animal Handling (WIS)</label>
      <label><input type="checkbox" id="skill-arcana" data-skill-id="arcana" /> Arcana (INT)</label>
      <label><input type="checkbox" id="skill-athletics" data-skill-id="athletics" /> Athletics (STR)</label>
      <label><input type="checkbox" id="skill-deception" data-skill-id="deception" /> Deception (CHA)</label>
      <label><input type="checkbox" id="skill-history" data-skill-id="history" /> History (INT)</label>
      <label><input type="checkbox" id="skill-insight" data-skill-id="insight" /> Insight (WIS)</label>
      <label><input type="checkbox" id="skill-intimidation" data-skill-id="intimidation" /> Intimidation (CHA)</label>
      <label><input type="checkbox" id="skill-investigation" data-skill-id="investigation" /> Investigation (INT)</label>
      <label><input type="checkbox" id="skill-medicine" data-skill-id="medicine" /> Medicine (WIS)</label>
      <label><input type="checkbox" id="skill-nature" data-skill-id="nature" /> Nature (INT)</label>
      <label><input type="checkbox" id="skill-perception" data-skill-id="perception" /> Perception (WIS)</label>
      <label><input type="checkbox" id="skill-performance" data-skill-id="performance" /> Performance (CHA)</label>
      <label><input type="checkbox" id="skill-persuasion" data-skill-id="persuasion" /> Persuasion (CHA)</label>
      <label><input type="checkbox" id="skill-religion" data-skill-id="religion" /> Religion (INT)</label>
      <label><input type="checkbox" id="skill-sleight-of-hand" data-skill-id="sleight-of-hand" /> Sleight of Hand (DEX)</label>
      <label><input type="checkbox" id="skill-stealth" data-skill-id="stealth" /> Stealth (DEX)</label>
      <label><input type="checkbox" id="skill-survival" data-skill-id="survival" /> Survival (WIS)</label>
    </div>

    <!-- Skill choice mount (DO NOT REMOVE) -->
    <div id="skillChoiceMount"></div>

    <!-- ================= Saving Throws ================= -->
    <section class="panel">
      <h2>Saving Throws</h2>

      <div class="saves">
        <label><input type="checkbox" id="save-str" /> Strength</label>
        <label><input type="checkbox" id="save-dex" /> Dexterity</label>
        <label><input type="checkbox" id="save-con" /> Constitution</label>
        <label><input type="checkbox" id="save-int" /> Intelligence</label>
        <label><input type="checkbox" id="save-wis" /> Wisdom</label>
        <label><input type="checkbox" id="save-cha" /> Charisma</label>
      </div>
    </section>

    <!-- ================= Ability Scores ================= -->
    <section class="panel">
      <h2>Ability Scores</h2>

      <div class="abilities">
        <div class="ability"><label>STR</label><input id="str" type="number" value="10"/><span id="strRaceBonus">+0</span><span id="strMod">(+0)</span></div>
        <div class="ability"><label>DEX</label><input id="dex" type="number" value="10"/><span id="dexRaceBonus">+0</span><span id="dexMod">(+0)</span></div>
        <div class="ability"><label>CON</label><input id="con" type="number" value="10"/><span id="conRaceBonus">+0</span><span id="conMod">(+0)</span></div>
        <div class="ability"><label>INT</label><input id="int" type="number" value="10"/><span id="intRaceBonus">+0</span><span id="intMod">(+0)</span></div>
        <div class="ability"><label>WIS</label><input id="wis" type="number" value="10"/><span id="wisRaceBonus">+0</span><span id="wisMod">(+0)</span></div>
        <div class="ability"><label>CHA</label><input id="cha" type="number" value="10"/><span id="chaRaceBonus">+0</span><span id="chaMod">(+0)</span></div>
      </div>
    </section>

    <!-- ================= Spellcasting ================= -->
     <!-- ================= Disposition ================= -->
<section class="panel" id="dispositionPanel" hidden>
  <h2>Disposition</h2>

  <select id="dispositionSelect">
    <option value="">‚Äî Choose Disposition ‚Äî</option>
    <option value="obligated-guardian">Obligated Guardian</option>
    <option value="reluctant-partner">Reluctant Partner</option>
    <option value="engaged-companion">Engaged Companion</option>
    <option value="steadfast-sentinel">Steadfast Sentinel</option>
  </select>

  <p id="dispositionDescription" class="hint"></p>
</section>

<!-- ================= Manifest Techniques ================= -->
<section class="panel" id="manifestTechniquesPanel" hidden>
  <h2>Manifest Techniques</h2>
  <div id="manifestTechniquesList"></div>
</section>


    <section class="panel" id="infusionsPanel" hidden>
  <h2>Infusions</h2>

  <!-- Known Infusions (learning only) -->
  <div id="knownInfusionsBlock" hidden>
    <label>
      Known Infusions
      <select id="infusionsSelect" multiple></select>
    </label>
    <p id="infusionsHint" class="muted"></p>
  </div>

  <!-- Active Infusions (always visible once artificer) -->
  <div id="activeInfusionsBlock" hidden>
    <h3>Active Infusions</h3>
    <div id="activeInfusionsCounter" class="muted"></div>
    <div id="activeInfusionsList">‚Äî</div>
  </div>
</section>

    <section class="panel spellcasting-panel">
      <h2>Spellcasting</h2>

      <p id="spellcastingWarning" class="warning" hidden>
        ‚ö†Ô∏è You cannot cast spells while wearing armor you are not proficient with.
      </p>

      <div id="spellcastingSummary" class="spell-summary"></div>

      <div class="spell-section">
        <h3>Spell Slots</h3>
        <div id="spellSlots"></div>
      </div>

      <div class="spell-section always-prepared">
        <h3>Always Prepared Spells</h3>
        <div id="alwaysPreparedSpells"></div>
      </div>
      <div id="cantripsKnownPanel">
        <h3>Cantrips Known</h3>
        <div id="cantripsKnownList"></div>
      </div>
      <div class="spell-section spellbook">
      <h3>Spellbook</h3>
      <div id="spellbookList">‚Äî</div>
    </div>
    <div class="spell-panel" id="spellsKnownPanel">
      <h3>Spells Known</h3>
      <div id="spellsKnownList">‚Äî</div>
    </div>

      <div class="spell-section prepared-spells">
        <h3>Prepared Spells</h3>
        <div id="preparedSpells"></div>
      </div>

      <div class="spell-section available-spells">
        <h3>Available Spells</h3>
        <div id="spellList"></div>
      </div>
    </section>

    <!-- ================= Features & Tools ================= -->
    <section class="panel">
      <h2>Features</h2>
      <div id="featuresList"></div>
      <div id="fighterResources" hidden class="subclass-block">
      <h3>Fighter Features</h3>

      <div class="fighter-feature">
        <button id="secondWindBtn">Second Wind</button>
        <span id="secondWindStatus" class="muted"></span>
      </div>

      <div class="fighter-feature">
        <button id="actionSurgeBtn">Action Surge</button>
        <span id="actionSurgeStatus" class="muted"></span>
      </div>

      <div class="fighter-feature">
        <button id="indomitableBtn">Indomitable</button>
        <span id="indomitableStatus" class="muted"></span>
      </div>
    </div>
  <div id="arcaneArcherBlock" hidden class="subclass-block">
    <h4>Arcane Archer</h4>

    <!-- Known Arcane Shots (learning only) -->
    <div id="knownArcaneShotsBlock" hidden>
      <label>
        Known Arcane Shots
        <select id="arcaneShotsLearnSelect" multiple></select>
      </label>
      <p id="arcaneShotsHint" class="muted"></p>
    </div>

    <!-- Active Arcane Shot (always visible once learned) -->
    <div id="arcaneShotUses" class="muted"></div>
    <div id="activeArcaneShotsBlock" hidden>
      <label>
        Active Arcane Shot
        <select id="arcaneShotSelect">
          <option value="">‚Äî Select Shot ‚Äî</option>
        </select>
      </label>

      <div id="arcaneShotDetailsList">‚Äî</div>
    </div>
  </div>

  <section id="characterFeats"> 
    <h3>Character Feats</h3>
    <div id="activeCharacterFeats"></div>
  </section>

  <!-- Feat Choice Modal -->
  <div id="featModal" hidden class="modal">
    <h2>Choose a Feat</h2>
    <div id="featOptions" class="scroll-panel"></div>
    <button id="confirmFeat" disabled>Confirm Feat</button>
  </div>
  <div id="featBackdrop" hidden class="modal-backdrop"></div>

  <h3>Tools</h3>
  <div id="toolsList">‚Äî</div>


    <!-- ================= Weapons ================= -->
     
    <section class="panel">
      <h2>Weapons</h2>
      <select id="weaponsSelect" multiple></select>

      <h3>Attacks & Spellcasting</h3>
      <table id="attacksTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Attack Bonus</th>
            <th>Damage</th>
            <th>Damage Type</th>
            <th>Properties</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
<!-- ================= Ostrumite Charges ================= -->
      <div
        id="ostrumiteChargesPanel"
        class="panel"
        hidden
      >
        <h3>Ostrumite Charges</h3>

        <div class="resource-row">
          <button id="ostrumiteMinus">‚àí</button>
          <span id="ostrumiteCurrent">0</span>
          /
          <span id="ostrumiteMax">0</span>
          <button id="ostrumitePlus">+</button>
        </div>

        <small class="hint">
          Recharges on a short rest.
        </small>
      </div>
    <section id="weaponModsPanel" class="panel" hidden>
      <h3>Ostrumite Gunblade (Prototype)</h3>

      <div class="mod-capacity">
        Mod Capacity:
        <span id="modsUsed">0</span> /
        <span id="modsMax">0</span>
      </div>

      <div class="mod-row">
        <label>Core</label>
        <select data-slot="core"></select>
      </div>

      <div class="mod-row">
        <label>Barrel</label>
        <select data-slot="barrel"></select>
      </div>

      <div class="mod-row">
        <label>Blade</label>
        <select data-slot="blade"></select>
      </div>

      <div class="mod-row">
        <label>Edge</label>
        <select data-slot="edge"></select>
      </div>

      <div class="mod-row">
        <label>Stabilizer</label>
        <select data-slot="stabilizer"></select>
      </div>
    </section>

    </div>

<!-- ================= Manifest Energy ================= -->
      <div
        id="manifestEnergyPanel"
        class="panel"
        hidden
      >
        <h3>Manifest Energy</h3>

        <div class="resource-row">
          <button id="manifestMinus">‚àí</button>
          <span id="manifestCurrent">0</span>
          /
          <span id="manifestMax">0</span>
          <button id="manifestPlus">+</button>
        </div>

        <small class="hint">
          Restores on a long rest.
        </small>
      </div>

    <!-- ================= Hit Points ================= -->
    <section class="panel">
      <h2>Hit Points</h2>

      <label>Hit Die: d<input id="hitDie" type="number" value="10" min="4" step="2"/></label>
      <label><input type="checkbox" id="useAverage" checked /> Use Average HP</label>

      <p>Max HP: <strong id="maxHp">0</strong></p>
      <label>Current HP <input id="currentHp" type="number" value="0"/></label>
      <label>Temp HP <input id="tempHp" type="number" value="0"/></label>

      <h3>Hit Dice</h3>
      <p>Total: <span id="totalHitDice">1</span></p>
      <label>Spent <input id="hitDiceSpent" type="number" value="0"/></label>
    </section>

    <!-- ================= Combat & Equipment ================= -->
    <section class="panel">
      <h2>Combat</h2>

      <div class="equipment-block">
        <label>
          Armor
          <select id="armorSelect">
            <option value="">‚Äî Unarmored ‚Äî</option>
          </select>
        </label>

        <div id="armorerModeBlock" hidden>
          <strong>Arcane Armor Configuration</strong>
          <label>
            Armorer Mode
            <select id="armorerModeSelect">
              <option value="guardian">Guardian (Thunder Gauntlets)</option>
              <option value="infiltrator">Infiltrator (Lightning Launcher)</option>
            </select>
          </label>
        </div>

        <label style="margin-left: 12px;">
          <input type="checkbox" id="shieldToggle" />
          Shield (+2 AC)
        </label>
      </div>

      <!-- Armor Proficiency Warning -->
      <div id="armorWarning" class="warning" hidden>
        ‚ö†Ô∏è You are wearing armor or a shield you are not proficient with.
        <br />
        You have disadvantage on STR & DEX checks and saving throws and cannot cast spells.

        <!-- Strength Requirement Warning -->
        <div id="strengthWarning" class="warning" hidden>
          ‚ö†Ô∏è Your Strength is too low for this armor.
          <br />
          Your speed is reduced by 10 ft.

          <div id="arcaneArmorNote" class="warning info" hidden>
            üõ† Arcane Armor active ‚Äî proficiency and Strength requirements are ignored.
          </div>
        </div>
      </div><div id="eldritchCannonBlock" hidden>
      <label>
        Eldritch Cannon
        <select id="eldritchCannonSelect">
          <option value="force-ballista">Force Ballista</option>
          <option value="flamethrower">Flamethrower</option>
          <option value="protector">Protector</option>
        </select>
      </label>

      <div id="eldritchCannonDescription" class="info"></div>
    </div>
    <div id="steelDefenderBlock" hidden class="subclass-block">
      <label>
        Steel Defender
        <select id="steelDefenderInfo">
          <option value="base">Base Capabilities</option>
          <option value="reaction">Deflect Attack (Reaction)</option>
          <option value="arcane-jolt">Arcane Jolt Synergy</option>
          <option value="improved">Improved Defender (Lv 15)</option>
        </select>
      </label>

      <div id="steelDefenderDetails" class="info-box"></div>
    </div>

          <p>Armor Class: <strong id="armorClass">10</strong></p>
      <p>Initiative: <strong id="initiative">+0</strong></p>

      <label>
        Speed
        <input id="speed" type="number" value="30" />
      </label>

      <label id="flySpeedBlock" hidden>
        Flying Speed
        <input id="flySpeed" type="number" disabled />
      </label>
    </section>

  </section>
<section class="panel">
  <h2>Magic Items</h2>

  <select id="magicItemsSelect" multiple></select>

  <h3>Attuned Items</h3>
  <div id="attunedItems"></div>
</section>

  <!-- ================= DETAIL VIEW (SPA PAGE) ================= -->
  <section id="detailView" class="detail-view" hidden></section>

</div>

<!-- ================= MODALS (UNCHANGED) ================= -->
<!-- Spell Detail Modal -->
<div id="spellDetailModal" hidden class="modal spell-modal">
  <h3 id="spellDetailTitle"></h3>
  <div id="spellDetailBody"></div>
  <button id="closeSpellDetail">Close</button>
</div>
<div id="spellDetailBackdrop" hidden class="modal-backdrop"></div>

<!-- Tool Choice -->
<div id="toolChoiceModal" hidden class="modal">
  <h3>Choose an Artisan Tool</h3>
  <div id="toolChoiceOptions"></div>
  <button id="confirmTool" disabled>Confirm</button>
</div>
<div id="toolChoiceBackdrop" hidden class="modal-backdrop"></div>

<!-- Skill Choice -->
<div id="modalBackdrop" class="modal-backdrop" hidden></div>
<section id="skillChoiceModal" class="modal" hidden>
  <h3 id="skillChoiceTitle">Choose Skills</h3>
  <p id="skillChoiceHint"></p>
  <div id="skillChoiceOptions"></div>
  <button id="confirmSkills" disabled>Confirm</button>
</section>

<!-- Subclass Choice -->
<div id="subclassModal" hidden class="modal">
  <h3 id="subclassTitle">Choose a Subclass</h3>
  <div id="subclassOptions"></div>
  <button id="confirmSubclass" disabled>Confirm</button>
</div>
<div id="subclassBackdrop" hidden class="modal-backdrop"></div>
<!-- =========================
     Choice Feature Modal
========================= -->
<div id="choiceFeatureBackdrop" class="modal-backdrop" hidden></div>

<div id="choiceFeatureModal" class="modal" hidden>
  <h3 id="choiceFeatureTitle"></h3>
  <p id="choiceFeatureHint" class="muted"></p>

  <div id="choiceFeatureOptions"></div>

  <button id="confirmChoiceFeature" disabled>Confirm</button>
</div>

<!-- ================= Scripts ================= -->
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script type="module" src="script.js"></script>
<script>
  // Prevent spell clicks from triggering global routing
  document.addEventListener("DOMContentLoaded", () => {
    document
      .querySelectorAll(".spell-section, .spellcasting-panel")
      .forEach(el => {
        el.addEventListener("click", e => {
          e.stopPropagation();
        });
      });
  });
</script>

</body>
</html>
